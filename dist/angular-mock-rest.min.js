/*! angular-mock-rest */
!function(){"use strict";var a=angular.module("mock.localBackend",["ngMockE2E","ngResource","LocalStorageModule","mock.fixtures"]);a.constant("localStorageNamespace","mock"),a.config(["localStorageServiceProvider","localStorageNamespace",function(a,b){a.setPrefix(b)}]),a.run(["MockFixtures","LocalBackend","$resource","$httpBackend","localStorageService","localStorageNamespace",function(a,b,c,d,e){e.clearAll();for(var f in a)b.registerEndpoint(a[f],f);window.$resource=c,window.$httpBackend=d}]),a.service("LocalBackend",["$httpBackend","LocalEndpoint","NotImplementedError",function(a,b,c){var d=function(a){var b=a.replace(/.*?\?/,""),c=[],d={};if(b.length){c=b.split("&");for(var e in c){var f=c[e].split("=")[0];f.length&&("undefined"==typeof d[f]&&(d[f]=[]),d[f].push(c[e].split("=")[1]))}}return d},e=function(a,b){var c=a.exec(b);return c.length>1?c[1]:null},f=function(a){for(var b=[],c={CREATE:"POST",READ:"GET",UPDATE:"POST",DELETE:"DELETE"},d=a.split("|"),e=0;e<d.length;e++)c[d[e]]&&b.push(c[d[e]]);return{Allow:b.join(", ")}},g=function(){this.endpoints=[]};return g.prototype={registerEndpoint:function(g,h){var i=new b(g.methods,g.data,g.matcher,h,g.primaryKey);a.whenGET(g.matcher).respond(function(a,b){var h,j=e(i.matcher,b),k=d(b);try{h=i.read(j,k)}catch(l){if(l instanceof c)return[405,"",f(g.methods)]}return[200,angular.toJson(h),{}]}),a.whenPOST(g.matcher).respond(function(a,b,d){var h=e(i.matcher,b);try{h?i.update(angular.fromJson(d)):i.create(angular.fromJson(d))}catch(j){if(j instanceof c)return[405,"",f(g.methods)]}return[200,"",{}]}),a.whenDELETE(g.matcher).respond(function(a,b){var d=e(i.matcher,b);try{i.delete(d)}catch(h){if(h instanceof c)return[405,"",f(g.methods)]}return[200,"",{}]}),this.endpoints.push(g)}},new g}]),a.factory("LocalEndpoint",["NotImplementedError","localStorageService",function(a,b){var c=function(a,c,d,e,f){this.matcher=d,this.key=e,this.primaryKey=f||"pk",this.nextPrimaryKeyValue=b.get(e+"_pk")||0;var g=new RegExp(a);this.create=g.test("CREATE")?this._create:this._throwError,this.read=g.test("READ")?this._read:this._throwError,this.update=g.test("UPDATE")?this._update:this._throwError,this.delete=g.test("DELETE")?this._delete:this._throwError,this._data=[];for(var h=0;h<c.length;h++)this._create(c[h])};return c.prototype={_create:function(a){var c={};c[this.primaryKey]=this.nextPrimaryKeyValue++,angular.extend(a,c);var d=b.get(this.key)||[];return d.push(a),b.add(this.key,d)},_read:function(a){var c=b.get(this.key);if(!a)return c;for(var d=0;d<c.length;d++)if(a==c[d][this.primaryKey])return c[d]},_update:function(a){for(var c=b.get(this.key)||[],d=0;d<c.length;d++)if(c[d][this.primaryKey]==a[this.primaryKey]){angular.extend(c[d],a);break}return b.add(this.key,c)},_delete:function(a){for(var c=b.get(this.key)||[],d=0;d<c.length;d++)if(c[d][this.primaryKey]==a){c.splice(d,1);break}return b.add(this.key,c)},_throwError:function(){throw new a}},c}]),a.factory("NotImplementedError",function(){var a=function(a){this.name="NotImplemented",this.message=a||"Method not implemented"};return a.prototype=new Error,a.prototype.constructor=a,a})}();